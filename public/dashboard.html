<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Aurora Priv√©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Import Map -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom": "https://esm.sh/react-dom@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "zustand": "https://esm.sh/zustand@4.5.2?deps=react@18.3.1",
          "zustand/middleware": "https://esm.sh/zustand@4.5.2/middleware?deps=react@18.3.1",
          "tesseract.js": "https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/+esm",
          "chart.js/auto": "https://esm.sh/chart.js@4.4.3/auto?dev"
        }
      }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 antialiased">
    <div id="dashboard-root"></div>

    <!-- Componentes compilados -->
    <script type="module">
        import { jsx as _jsx, jsxs as _jsxs } from 'react/jsx-runtime';
        import { useEffect, useState } from 'react';
        import { createRoot } from 'react-dom/client';
        import { DashboardLayout } from './js/public/ts/components/DashboardLayout.js';
        import { LoanApplicationWizard } from './js/public/ts/components/LoanApplicationWizard.js';
        import { PrivateSimulator } from './js/public/ts/components/PrivateSimulator.js';
        import { useAuth } from './js/public/ts/store/authStore.js?v=20251125-16';

        console.log('dashboard.html module script loaded (JSX runtime)');

        // Componente principal del Dashboard usando JSX runtime
        function DashboardApp() {
            const { user, isLoading, checkAuth } = useAuth();
            const [currentView, setCurrentView] = useState('inicio');

            console.log('DashboardApp render - user:', user, 'isLoading:', isLoading, 'currentView:', currentView);

            // Verificar autenticaci√≥n al cargar
            useEffect(() => {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/index.html';
                    return;
                }
                checkAuth();
            }, [checkAuth]);

            // Redirigir a login si no est√° autenticado
            useEffect(() => {
                if (!isLoading && !user) {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = '/index.html';
                    }
                }
            }, [user, isLoading]);

            if (isLoading) {
                return _jsx('div', { className: 'flex items-center justify-center h-screen', children: _jsxs('div', { className: 'text-center', children: [
                    _jsx('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4' }),
                    _jsx('p', { className: 'text-gray-600', children: 'Cargando...' })
                ] }) });
            }

            if (!user) {
                console.log('DashboardApp render - no user, returning null');
                return null;
            }

            console.log('‚úÖ User loaded, rendering dashboard:', user);

            // Renderizar contenido seg√∫n vista activa
            const renderContent = () => {
                const score = user.cliente?.scoreCredito || 950;
                const ingresos = user.cliente?.ingresosMensuales || 0;

                switch (currentView) {
                    case 'inicio':
                        return _jsx('div', { className: 'p-8', children: _jsxs('div', { children: [
                            _jsxs('div', { className: 'mb-8', children: [
                                _jsxs('h1', { className: 'text-3xl font-bold text-gray-900 mb-2', children: [`Bienvenido, ${user.nombre} üëã`] }),
                                _jsx('p', { className: 'text-gray-600', children: 'Gestiona tus cr√©ditos y simula nuevas opciones de financiamiento' })
                            ] }),
                            _jsxs('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8', children: [
                                _jsxs('div', { className: 'bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 shadow-xl text-white', children: [
                                    _jsx('div', { className: 'flex items-center justify-between mb-4', children: _jsxs('div', { children: [
                                        _jsx('p', { className: 'text-sm opacity-90', children: 'Score Crediticio' }),
                                        _jsx('p', { className: 'text-4xl font-bold mt-2', children: score })
                                    ] }) }),
                                    _jsx('div', { className: 'w-full bg-white/20 rounded-full h-2', children: _jsx('div', { className: 'bg-white h-2 rounded-full', style: { width: `${(score / 1000) * 100}%` } }) })
                                ] }),
                                _jsxs('div', { className: 'bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-6 shadow-xl text-white', children: [
                                    _jsx('p', { className: 'text-sm opacity-90', children: 'Ingresos Mensuales' }),
                                    _jsx('p', { className: 'text-3xl font-bold mt-2', children: ingresos > 0 ? `$${ingresos.toLocaleString('es-CL')}` : 'No registrado' })
                                ] }),
                                _jsxs('div', { className: 'bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-xl text-white', children: [
                                    _jsx('p', { className: 'text-sm opacity-90', children: 'Cr√©dito Pre-aprobado' }),
                                    _jsx('p', { className: 'text-3xl font-bold mt-2', children: ingresos > 0 ? `$${(ingresos * 3).toLocaleString('es-CL')}` : 'N/A' })
                                ] })
                            ] }),
                            _jsxs('div', { className: 'bg-white rounded-2xl p-6 shadow-lg', children: [
                                _jsx('h2', { className: 'text-2xl font-bold text-gray-900 mb-4', children: 'Acciones R√°pidas' }),
                                _jsxs('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4', children: [
                                    _jsxs('button', { onClick: () => setCurrentView('nueva-solicitud'), className: 'flex items-center space-x-4 p-4 border-2 border-blue-200 rounded-xl hover:bg-blue-50 hover:border-blue-400 transition-all', children: [
                                        _jsx('div', { className: 'w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center', children: _jsx('svg', { className: 'w-6 h-6 text-blue-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24', children: _jsx('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M12 4v16m8-8H4' }) }) }),
                                        _jsxs('div', { className: 'text-left', children: [
                                            _jsx('h3', { className: 'font-bold text-gray-900', children: 'Solicitar Cr√©dito' }),
                                            _jsx('p', { className: 'text-sm text-gray-600', children: 'Con OCR y scoring' })
                                        ] })
                                    ] }),
                                    _jsxs('button', { onClick: () => setCurrentView('simulador'), className: 'flex items-center space-x-4 p-4 border-2 border-purple-200 rounded-xl hover:bg-purple-50 hover:border-purple-400 transition-all', children: [
                                        _jsx('div', { className: 'w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center', children: _jsx('svg', { className: 'w-6 h-6 text-purple-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24', children: _jsx('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z' }) }) }),
                                        _jsxs('div', { className: 'text-left', children: [
                                            _jsx('h3', { className: 'font-bold text-gray-900', children: 'Simulador' }),
                                            _jsx('p', { className: 'text-sm text-gray-600', children: 'Calcula tu cuota' })
                                        ] })
                                    ] }),
                                    _jsxs('button', { onClick: () => setCurrentView('solicitudes'), className: 'flex items-center space-x-4 p-4 border-2 border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all', children: [
                                        _jsx('div', { className: 'w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center', children: _jsx('svg', { className: 'w-6 h-6 text-gray-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24', children: _jsx('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z' }) }) }),
                                        _jsxs('div', { className: 'text-left', children: [
                                            _jsx('h3', { className: 'font-bold text-gray-900', children: 'Solicitudes' }),
                                            _jsx('p', { className: 'text-sm text-gray-600', children: 'Ver historial' })
                                        ] })
                                    ] })
                                ] })
                            ] })
                        ] }) });
                    
                    case 'nueva-solicitud':
                        return _jsx(LoanApplicationWizard, {});
                    
                    case 'simulador':
                        return _jsx(PrivateSimulator, {});
                    
                    case 'solicitudes':
                        return _jsxs('div', { className: 'p-8', children: [
                            _jsx('h2', { className: 'text-2xl font-bold text-gray-900 mb-4', children: 'Mis Solicitudes' }),
                            _jsx('div', { className: 'bg-white rounded-lg shadow p-6', children: _jsx('p', { className: 'text-gray-600', children: 'Aqu√≠ ver√°s el historial de tus solicitudes de cr√©dito.' }) })
                        ] });
                    
                    case 'historial':
                        return _jsxs('div', { className: 'p-8', children: [
                            _jsx('h2', { className: 'text-2xl font-bold text-gray-900 mb-4', children: 'Historial' }),
                            _jsx('div', { className: 'bg-white rounded-lg shadow p-6', children: _jsx('p', { className: 'text-gray-600', children: 'Aqu√≠ ver√°s tu historial crediticio completo.' }) })
                        ] });
                    
                    case 'perfil':
                        return _jsxs('div', { className: 'p-8', children: [
                            _jsx('h2', { className: 'text-2xl font-bold text-gray-900 mb-4', children: 'Mi Perfil' }),
                            _jsx('div', { className: 'bg-white rounded-lg shadow p-6', children: _jsx('p', { className: 'text-gray-600', children: 'Gestiona tu informaci√≥n personal.' }) })
                        ] });
                    
                    default:
                        return _jsx('div', { className: 'p-8', children: _jsx('h1', { children: 'Dashboard' }) });
                }
            };

            console.log('About to render DashboardLayout with user:', user);

            // Renderizar con DashboardLayout
            const result = _jsx(DashboardLayout, {
                currentView: currentView,
                onNavigate: setCurrentView,
                user: user,
                children: renderContent()
            });

            console.log('DashboardLayout result:', result);

            return result;
        }

        // Montar la aplicaci√≥n
        const rootElement = document.getElementById('dashboard-root');
        if (rootElement) {
            console.log('dashboard mounting root');
            const root = createRoot(rootElement);
            root.render(_jsx(DashboardApp, {}));
            
            // Debug: after mount
            setTimeout(() => {
                console.log('DEBUG rootElement.innerHTML length:', rootElement.innerHTML.length);
                console.log('DEBUG rootElement.childElementCount:', rootElement.childElementCount);
                if (rootElement.innerHTML.length > 0) {
                    console.log('‚úÖ Dashboard rendered successfully!');
                } else {
                    console.error('‚ùå Dashboard still empty after mount');
                }
            }, 1000);
        }
    </script>
</body>
</html>
